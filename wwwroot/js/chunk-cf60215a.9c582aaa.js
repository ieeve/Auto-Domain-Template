(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cf60215a"],{"25f0":function(t,e,a){"use strict";var i=a("6eeb"),n=a("825a"),l=a("d039"),o=a("ad6d"),r="toString",s=RegExp.prototype,c=s[r],u=l((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),d=c.name!=r;(u||d)&&i(RegExp.prototype,r,(function(){var t=n(this),e=String(t.source),a=t.flags,i=String(void 0===a&&t instanceof RegExp&&!("flags"in s)?o.call(t):a);return"/"+e+"/"+i}),{unsafe:!0})},2942:function(t,e,a){"use strict";var i=a("b775");e["a"]={postQuery:function(t){return Object(i["a"])({url:"/cooperation/cooperationability/GetPage",method:"post",data:t})},saveAudit:function(t){return Object(i["a"])({url:"/cooperation/cooperationability/saveAudit",method:"post",data:t})},goBackAuit:function(t){return Object(i["a"])({url:"/cooperation/cooperationability/goBackAuit",method:"post",data:t})},getCbListByid:function(t){return Object(i["a"])({url:"/cooperation/cooperationability/GetCBListByID",method:"get",params:{id:t}})},GetSelectListByID:function(t){return Object(i["a"])({url:"/cooperation/cooperationability/GetSelectListByID",method:"get",params:{label:t}})},insertCooperabilityOtherDept:function(){return Object(i["a"])({url:"/cooperation/cooperationability/insertCooperabilityOtherDept",method:"post"})}}},"648b":function(t,e,a){"use strict";var i=a("95ed"),n=a.n(i);n.a},"95ed":function(t,e,a){},b64b:function(t,e,a){var i=a("23e7"),n=a("7b0b"),l=a("df75"),o=a("d039"),r=o((function(){l(1)}));i({target:"Object",stat:!0,forced:r},{keys:function(t){return l(n(t))}})},baa5:function(t,e,a){var i=a("23e7"),n=a("e58c");i({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},c698:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"plan"},[a("el-row",{staticClass:"page-tools"},[a("el-col",{attrs:{span:20}},[a("div",[a("el-button",{attrs:{size:"mini"},on:{click:t.exportCsvEvent}},[t._v("Excel")]),a("el-button",{attrs:{size:"mini"},on:{click:t.auditGoback}},[t._v("退回")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isImportShow,expression:"isImportShow"}],attrs:{size:"mini"},on:{click:t.ImportOtherDep}},[t._v("导入")]),a("span",{staticStyle:{"font-size":"13px",color:"grey","margin-left":"15px"}},[t._v("主制厂："+t._s(t.mainplant))])],1)]),a("el-col",{attrs:{span:2}},[a("el-switch",{attrs:{"active-text":"自动换行","inactive-text":""},model:{value:t.isLineWarp,callback:function(e){t.isLineWarp=e},expression:"isLineWarp"}})],1)],1),a("elx-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"elxTable",staticStyle:{width:"100%"},attrs:{config:{render:"scroll"},data:t.tableData.data,height:t.tableHeight,"tooltip-effect":"dark",border:"","highlight-current-row":""},on:{"cell-dblclick":t.RowDialogEvent,"row-click":t.MainClickRow,"sort-change":t.tableSortChange,"selection-change":t.mainSelectionChange}},[a("elx-table-column",{attrs:{type:"selection",width:"35"}}),a("elx-table-column",{attrs:{label:"",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[null==e.row.CONFIRMPERSON?[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.RowDialogEvent(e.row,e.$index)}}},[t._v("待审")])]:[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.RowDialogEvent(e.row,e.$index)}}},[t._v("已审")])]]}}])},[a("template",{slot:"header"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.listQuery.ext,expression:"listQuery.ext"}],on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.listQuery,"ext",e.target.multiple?a:a[0])},t.fetchData]}},[a("option",{attrs:{value:"全部"}},[t._v("全部")]),a("option",{attrs:{value:"待审"}},[t._v("待审")]),a("option",{attrs:{value:"已审"}},[t._v("已审")])])])],2),a("elx-table-column",{attrs:{prop:"RN",label:"编号",width:"45"}}),t._l(t.listQuery.ColumnHeader,(function(e,i){return a("elx-table-column",{key:e.field,attrs:{prop:e.field,"min-width":e.width,sortable:"custom","show-overflow-tooltip":!t.isLineWarp},scopedSlots:t._u([{key:"default",fn:function(i){return"ITEMNUMBER"==e.field||"boolean"==e.datatype?["ITEMNUMBER"==e.field?a("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.dataDetailClick(i.row.PROJECTID,i.row.ITEMNUMBER)}}},[t._v(t._s(i.row[e.field]))]):t._e(),"boolean"==e.datatype?[a("i",{directives:[{name:"show",rawName:"v-show",value:1==i.row[e.field],expression:"scope.row[col.field]==1"}],staticClass:"el-icon-circle-check",staticStyle:{color:"#67C23A","font-size":"150%"}}),a("i",{directives:[{name:"show",rawName:"v-show",value:1!=i.row[e.field],expression:"scope.row[col.field]!=1"}],staticClass:"el-icon-circle-close",staticStyle:{color:"#aaa","font-size":"150%"}})]:t._e()]:void 0}}],null,!0)},[a("template",{slot:"header"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"col.search"}],attrs:{size:"mini",placeholder:e.title},domProps:{value:e.search},on:{click:function(t){t.stopPropagation()},keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.changeSearch(e,i)},input:function(a){a.target.composing||t.$set(e,"search",a.target.value)}}}),a("i",{directives:[{name:"show",rawName:"v-show",value:e.search,expression:"col.search"}],staticClass:"el-icon-error closeicon",staticStyle:{"margin-left":"-16px"},on:{click:function(a){e.search="",t.changeSearch(e,i),a.stopPropagation()}}})])],2)}))],2),a("el-row",{staticClass:"table-footer"},[a("el-pagination",{attrs:{background:"","current-page":t.listQuery.currentPage,"page-size":t.listQuery.pageSize,"page-sizes":[50,100,200,500,1e3],layout:"sizes,prev, pager, next,total",total:t.tableData.total},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange,"update:currentPage":function(e){return t.$set(t.listQuery,"currentPage",e)},"update:current-page":function(e){return t.$set(t.listQuery,"currentPage",e)}}})],1),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:t.dialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-row",{staticStyle:{padding:"5px"}},[a("el-col",{attrs:{span:8}},[t._v(" 工号："+t._s(t.dialogData.row.PROJECTID)+" ")]),a("el-col",{attrs:{span:8}},[t._v(" 图号："+t._s(t.dialogData.row.ITEMNUMBER)+" ")]),a("el-col",{attrs:{span:8}},[t._v(" 名称："+t._s(t.dialogData.row.DESCRIPTION)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.toggleSelection(t.dialogData.data)}}},[t._v("反选")])],1),a("el-col",{attrs:{span:18}},[t._v(" 数量： "),a("el-input-number",{attrs:{size:"mini",min:1,max:t.dialogData.inputMax,label:"数量"},model:{value:t.dialogData.inputNum,callback:function(e){t.$set(t.dialogData,"inputNum",e)},expression:"dialogData.inputNum"}}),a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",placeholder:"委外"},on:{change:t.select1ValueChange},model:{value:t.dialogData.Select1Value,callback:function(e){t.$set(t.dialogData,"Select1Value",e)},expression:"dialogData.Select1Value"}},t._l(t.Select1Items,(function(t){return a("el-option",{key:t.ID,attrs:{label:t.KEYED_NAME,value:t.ID}})})),1),a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",placeholder:"计划价"},model:{value:t.dialogData.Select2Value,callback:function(e){t.$set(t.dialogData,"Select2Value",e)},expression:"dialogData.Select2Value"}},t._l(t.Select2Items,(function(t){return a("el-option",{key:t.ID,attrs:{label:t.KEYED_NAME,value:t.ID}})})),1)],1),a("el-col",{attrs:{span:3}},[null==t.dialogData.row.CONFIRMPERSON?[a("el-button",{attrs:{size:"mini",type:"primary",loading:t.btnSavaLoading},on:{click:t.savaAudit}},[t._v("保 存")])]:[a("el-button",{attrs:{size:"mini",type:"warning",loading:t.btnSavaLoading},on:{click:t.savaAudit}},[t._v("修 改")])]],2)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}],ref:"refDialogTable",attrs:{data:t.dialogData.data,border:""},on:{"row-click":t.clickRow,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",selectable:t.selectable,width:"35"}}),a("el-table-column",{attrs:{property:"rowNo",label:"序号",width:"150"}}),a("el-table-column",{attrs:{property:"processName",label:"工序名",width:"200"}}),a("el-table-column",{attrs:{property:"processSpan",label:"工时"}}),a("el-table-column",{attrs:{property:"tag",label:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{"font-size":"16px",color:"#67C23A"}},[t._v(t._s(e.row.tag))])]}}])})],1)],1)],1)},n=[],l=(a("99af"),a("4160"),a("c975"),a("baa5"),a("a434"),a("b64b"),a("d3b7"),a("ac1f"),a("25f0"),a("5319"),a("1276"),a("159b"),a("96cf"),a("1da1")),o=a("2942"),r={data:function(){return{tableHeight:window.innerHeight-182,multipleSelection:[],mainSelection:[],tableData:{data:null,total:0},isLineWarp:!1,listLoading:!0,dialogLoading:!1,listQuery:{pageSize:50,currentPage:1,ext:"全部",ColumnHeader:[]},dialogVisible:!1,btnSavaLoading:!1,dialogData:{row:{},data:[],Select1Value:"",Select2Value:"",inputNum:0,inputMax:0},Select1Items:{},Select2Items:{},mainplant:"",isImportShow:!1}},created:function(){this.fetchData()},mounted:function(){var t=this;window.onresize=function(){t.tableHeight=window.innerHeight-182},o["a"].GetSelectListByID("工单委外状态").then((function(e){t.Select1Items=e.data})),o["a"].GetSelectListByID("核算类型").then((function(e){t.Select2Items=e.data}))},computed:{},methods:{tableSortChange:function(t,e,a){this.listQuery.ColumnHeader.forEach((function(e){e.field==t.prop?e.order="descending"===t.order?"desc":"asc":e.order=""})),this.fetchData()},changeSearch:function(t,e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.fetchData();case 2:case"end":return t.stop()}}),t)})))()},fetchData:function(){var t=this;this.listLoading=!0,o["a"].postQuery(this.listQuery).then((function(e){t.tableData.data=e.data,t.tableData.total=e.total,t.mainplant=e.ext,t.isImportShow="重型装备厂"!=e.ext,0==Object.keys(t.listQuery.ColumnHeader).length&&(t.listQuery.ColumnHeader=e.columns),t.listLoading=!1}))},dataDetailClick:function(t,e){window.open("http://10.17.10.202/static/#/get_wo_by?gzl="+t+"&tu="+e,"_blank")},handleSizeChange:function(t){this.listQuery.pageSize=t,this.fetchData()},handleCurrentChange:function(t){this.listQuery.currentPage=t,this.fetchData()},toggleSelection:function(t){var e=this;t?t.forEach((function(t){e.$refs.refDialogTable.toggleRowSelection(t)})):this.$refs.refDialogTable.clearSelection()},RowDialogEvent:function(t){var e=this;if(this.dialogVisible=!0,this.dialogData.row=t,this.dialogData.data=[],this.dialogData.inputMax=t.QUANTITY,this.dialogData.inputNum=t.QUANTITY,null==t.CONFIRMPERSON){t.FULLROUTE=t.FULLROUTE.replace("(null)",0);for(var a=t.FULLROUTE.split(")|"),i=0;i<a.length;i++){var n={rowNo:i+1,processName:a[i].split("(")[0],processSpan:a[i].split("(")[1].replace(")",""),tag:""};this.dialogLoading=!1,this.dialogData.data.push(n)}}else this.dialogLoading=!0,o["a"].getCbListByid(t.ID).then((function(t){for(var a=t.data,i=0;i<a.length;i++){var n={rowNo:a[i].SEQ_NO,processName:a[i].MACHINE,processSpan:a[i].TIME_SETUP+"/"+a[i].TIME_RUN,tag:"已审"};e.dialogData.data.push(n)}e.dialogLoading=!1,e.toggleSelection(e.dialogData.data)}))},handleSelectionChange:function(t){this.multipleSelection=t,this.multipleSelection.length==this.dialogData.data.length?this.dialogData.Select1Value="920DCAB2FC254137A4ACC690FD81ED79":this.dialogData.Select1Value="68BF9D1B613544DA8F667A89F3EDF8D4"},mainSelectionChange:function(t){this.mainSelection=t},savaAudit:function(){var t=this;if(""!=this.dialogData.Select1Value&&""!=this.dialogData.Select2Value){this.btnSavaLoading=!0;var e={id:this.dialogData.row,rows:this.multipleSelection,quantity:this.dialogData.inputNum,select1:this.dialogData.Select1Value,select2:this.dialogData.Select2Value};o["a"].saveAudit(e).then((function(e){t.dialogVisible=!1;var a=t.tableData.data.indexOf(t.dialogData.row);"9BF37E3389904ACEAC5A90D4D2E7A275"==t.dialogData.Select1Value||t.multipleSelection.length>0?t.tableData.data[a].CONFIRMPERSON=e.data:t.tableData.data[a].CONFIRMPERSON=null,t.$message.success("保存成功"),t.btnSavaLoading=!1})).catch((function(e){t.$message.error("保存失败"+e.msg),t.btnSavaLoading=!1}))}else this.$message.warning("请选择必要的信息！")},clickRow:function(t){this.$refs.refDialogTable.toggleRowSelection(t)},MainClickRow:function(t,e){"selection"==e.type&&this.$refs.elxTable.toggleRowSelection(t)},exportCsvEvent:function(){var t="[{";this.listQuery.ColumnHeader.forEach((function(e){t+='"'+e.field+'":"'+e.title+'",'})),t=t.substring(0,t.lastIndexOf(",")),t+="}]";for(var e=JSON.parse(t),a=e.concat(this.tableData.data),i=0,n=a.length;i<n;i++)for(var l in a[i]){var o=a[i][l];null!=o&&-1!=o.toString().indexOf(",")&&(a[i][l]=a[i][l].replace(/,/g,"，")),null!=o&&-1!=o.toString().indexOf("\r\n")&&(a[i][l]=a[i][l].replace(/[\r\n]/g,""))}this.$refs.elxTable.exportCsv({filename:"Table",data:a,original:!0})},auditGoback:function(){var t=this,e=this.mainSelection.length;if(0!=e){var a=0;this.mainSelection.forEach((function(t){null!=t.CONFIRMPERSON&&a++})),a>0?this.$message.error("已审核的记录不能退回，请重新选择！"):this.$confirm("确定要退回已选择的【 "+e+" 】条记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){o["a"].goBackAuit(t.mainSelection).then((function(){t.mainSelection.forEach((function(e){var a=t.tableData.data.indexOf(e);t.tableData.data.splice(a,1)})),t.$message.success("成功退回【 "+e+" 】条记录!")})).catch((function(e){t.$message.error("退回失败"+e.msg)}))}))}else this.$message.warning("请选择需要退回的内容！")},ImportOtherDep:function(){var t=this;this.listLoading=!0,o["a"].insertCooperabilityOtherDept().then((function(e){t.$message.success(e.msg),t.listLoading=!1}))},select1ValueChange:function(t){"9BF37E3389904ACEAC5A90D4D2E7A275"==t&&(this.dialogData.Select2Value="4433D9D1E9CE40F6B8EFB50E7720EA64")},selectable:function(){return"9BF37E3389904ACEAC5A90D4D2E7A275"!=this.dialogData.Select1Value}}},s=r,c=(a("648b"),a("2877")),u=Object(c["a"])(s,i,n,!1,null,"747874e2",null);e["default"]=u.exports},e58c:function(t,e,a){"use strict";var i=a("fc6a"),n=a("a691"),l=a("50c4"),o=a("a640"),r=a("ae40"),s=Math.min,c=[].lastIndexOf,u=!!c&&1/[1].lastIndexOf(1,-0)<0,d=o("lastIndexOf"),g=r("indexOf",{ACCESSORS:!0,1:0}),p=u||!d||!g;t.exports=p?function(t){if(u)return c.apply(this,arguments)||0;var e=i(this),a=l(e.length),o=a-1;for(arguments.length>1&&(o=s(o,n(arguments[1]))),o<0&&(o=a+o);o>=0;o--)if(o in e&&e[o]===t)return o||0;return-1}:c}}]);